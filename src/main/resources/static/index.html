<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lottery App</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1, h2 { color: #333; }
        .container { display: flex; gap: 20px; }
        .section { border: 1px solid #ccc; padding: 15px; border-radius: 8px; flex: 1; }
        input[type="text"] { padding: 8px; margin-right: 5px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        ul { list-style-type: none; padding: 0; }
        li { background-color: #f9f9f9; padding: 8px; margin-bottom: 5px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Lottery Application</h1>

    <div class="container">
        <div class="section">
            <h2>Add Participant</h2>
            <input type="text" id="participantName" placeholder="Participant Name">
            <button onclick="addParticipant()">Add Participant</button>
            <p id="addParticipantMessage"></p>
        </div>

        <div class="section">
            <h2>Lottery Actions</h2>
            <button onclick="drawWinner()">Draw Winner</button>
            <p id="drawWinnerMessage"></p>
        </div>
    </div>

    <div class="container" style="margin-top: 20px;">
        <div class="section">
            <h2>Participants</h2>
            <ul id="participantsList"></ul>
        </div>

        <div class="section">
            <h2>Lottery Results</h2>
            <ul id="resultsList"></ul>
        </div>
    </div>

    <script>
        const participantNameInput = document.getElementById('participantName');
        const participantsList = document.getElementById('participantsList');
        const resultsList = document.getElementById('resultsList');
        const addParticipantMessage = document.getElementById('addParticipantMessage');
        const drawWinnerMessage = document.getElementById('drawWinnerMessage');

        async function fetchParticipants() {
            const response = await fetch('/api/participants');
            const participants = await response.json();
            participantsList.innerHTML = '';
            participants.forEach(p => {
                const li = document.createElement('li');
                li.textContent = p.name;
                participantsList.appendChild(li);
            });
        }

        async function fetchResults() {
            const response = await fetch('/api/lottery/results');
            const results = await response.json();
            resultsList.innerHTML = '';
            results.forEach(r => {
                const li = document.createElement('li');
                li.textContent = `Winner: ${r.winnerName} (Time: ${new Date(r.drawTime).toLocaleString()})`;
                resultsList.appendChild(li);
            });
        }

        async function addParticipant() {
            const name = participantNameInput.value;
            if (!name) {
                addParticipantMessage.textContent = 'Please enter a participant name.';
                addParticipantMessage.style.color = 'red';
                return;
            }
            const response = await fetch('/api/participants', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: name })
            });
            if (response.ok) {
                addParticipantMessage.textContent = 'Participant added successfully!';
                addParticipantMessage.style.color = 'green';
                participantNameInput.value = '';
                fetchParticipants();
            } else {
                addParticipantMessage.textContent = 'Failed to add participant.';
                addParticipantMessage.style.color = 'red';
            }
        }

        async function drawWinner() {
            drawWinnerMessage.textContent = 'Drawing winner...';
            drawWinnerMessage.style.color = 'black';
            const response = await fetch('/api/lottery/draw', {
                method: 'POST'
            });
            if (response.ok) {
                const result = await response.json();
                drawWinnerMessage.textContent = `Winner: ${result.winnerName}! Congratulations!`;
                drawWinnerMessage.style.color = 'green';
                fetchParticipants();
                fetchResults();
            } else {
                const errorText = await response.text();
                drawWinnerMessage.textContent = `Error drawing winner: ${errorText}`;
                drawWinnerMessage.style.color = 'red';
            }
        }

        // Initial load
        fetchParticipants();
        fetchResults();
    </script>
</body>
</html>
